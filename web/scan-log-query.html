<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>å®¶å®½è¿ç»´æ”¯æ’‘ç³»ç»Ÿ Â· æ‰«ç è®°å½•æŸ¥è¯¢ / æ•…éšœç»ˆç«¯æŸ¥è¯¢</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
        "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", sans-serif;
      background: #f3f4f6;
      color: #111827;
    }
    a { text-decoration: none; color: inherit; }

    .layout {
      display: grid;
      grid-template-columns: 220px 1fr;
      height: 100vh;
    }

    /* ä¾§è¾¹æ  */
    .sidebar {
      background: #0f172a;
      color: #e5e7eb;
      display: flex;
      flex-direction: column;
    }
    .sidebar-header {
      height: 56px;
      display: flex;
      align-items: center;
      padding: 0 16px;
      border-bottom: 1px solid rgba(148,163,184,0.4);
      font-size: 16px;
      font-weight: 600;
    }
    .sidebar-header span.logo {
      width: 28px;
      height: 28px;
      border-radius: 8px;
      background: linear-gradient(135deg,#2563eb,#06b6d4);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      margin-right: 8px;
    }
    .menu-group-title {
      font-size: 12px;
      color: #9ca3af;
      padding: 16px 16px 4px;
    }
    .menu-item {
      padding: 8px 16px;
      font-size: 13px;
      display: flex;
      align-items: center;
      cursor: pointer;
      color: #e5e7eb;
    }
    .menu-item span.icon {
      margin-right: 6px;
      font-size: 15px;
    }
    .menu-item.active {
      background: rgba(37,99,235,0.18);
      color: #ffffff;
    }
    .submenu {
      padding-left: 34px;
      padding-bottom: 10px;
    }
    .submenu-item {
      font-size: 13px;
      padding: 6px 12px;
      border-radius: 6px;
      cursor: pointer;
      color: #cbd5f5;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .submenu-item.active {
      background: #1d4ed8;
      color: #fff;
    }

    /* é¡¶éƒ¨æ  + å†…å®¹ */
    .main {
      display: flex;
      flex-direction: column;
      height: 100vh;
    }
    .topbar {
      height: 56px;
      background: #ffffff;
      border-bottom: 1px solid #e5e7eb;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 20px;
      font-size: 14px;
    }
    .breadcrumb {
      font-size: 12px;
      color: #6b7280;
    }
    .breadcrumb span.current {
      color: #111827;
      font-weight: 500;
    }
    .topbar-right {
      font-size: 12px;
      color: #6b7280;
    }

    .content {
      flex: 1;
      overflow-y: auto;
      padding: 18px 20px 24px;
    }

    .page-title {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 12px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .page-title-sub {
      font-size: 12px;
      color: #6b7280;
    }

    /* å¡ç‰‡ */
    .card {
      background: #ffffff;
      border-radius: 10px;
      box-shadow: 0 1px 3px rgba(15,23,42,0.06);
      padding: 14px 14px 10px;
      margin-bottom: 14px;
    }

    .filter-grid {
      display: grid;
      grid-template-columns: repeat(4,minmax(0,1fr));
      gap: 10px 12px;
      font-size: 13px;
      align-items: center;
    }
    .form-item {
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .form-label {
      width: 96px;
      text-align: right;
      font-size: 12px;
      color: #4b5563;
      white-space: nowrap;
    }
    .form-control {
      flex: 1;
    }
    select, input[type="text"], input[type="date"] {
      width: 100%;
      border-radius: 6px;
      border: 1px solid #d1d5db;
      padding: 5px 8px;
      font-size: 12px;
      outline: none;
    }
    select:focus, input[type="text"]:focus, input[type="date"]:focus {
      border-color: #2563eb;
      box-shadow: 0 0 0 1px rgba(37,99,235,0.18);
    }

    .filter-actions {
      display: flex;
      justify-content: flex-end;
      margin-top: 10px;
      gap: 8px;
    }
    .btn {
      font-size: 12px;
      border-radius: 999px;
      border: 1px solid #d1d5db;
      padding: 6px 16px;
      background: #ffffff;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }
    .btn-primary {
      background: #2563eb;
      border-color: #2563eb;
      color: #ffffff;
    }
    .btn-outline {
      background: #ffffff;
      color: #374151;
    }
    .btn-secondary {
      background: #eff6ff;
      border-color: #bfdbfe;
      color: #1d4ed8;
    }

    /* è¡¨æ ¼ */
    .table-wrapper {
      background: #ffffff;
      border-radius: 10px;
      box-shadow: 0 1px 3px rgba(15,23,42,0.06);
      padding: 10px 14px 12px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 12px;
    }
    thead {
      background: #f9fafb;
    }
    th, td {
      padding: 8px 6px;
      border-bottom: 1px solid #e5e7eb;
      text-align: left;
      white-space: nowrap;
    }
    th {
      color: #4b5563;
      font-weight: 500;
    }
    tbody tr:nth-child(even) {
      background: #f9fafb;
    }
    .tag {
      display: inline-flex;
      align-items: center;
      padding: 0 8px;
      border-radius: 999px;
      font-size: 11px;
      line-height: 18px;
    }
    .tag-success {
      background: #dcfce7;
      color: #166534;
    }
    .tag-warning {
      background: #fef3c7;
      color: #92400e;
    }
    .tag-danger {
      background: #fee2e2;
      color: #b91c1c;
    }
    .tag-gray {
      background: #e5e7eb;
      color: #374151;
    }
    .text-link {
      font-size: 12px;
      color: #2563eb;
      cursor: pointer;
    }

    .table-footer {
      margin-top: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 12px;
      color: #6b7280;
    }
    .pager {
      display: inline-flex;
      gap: 4px;
      align-items: center;
    }
    .pager button {
      border-radius: 4px;
      border: 1px solid #d1d5db;
      background: #ffffff;
      padding: 2px 6px;
      font-size: 11px;
      cursor: pointer;
    }
    .pager button.active {
      background: #2563eb;
      color: #ffffff;
      border-color: #2563eb;
    }

    /* å¼¹çª—ï¼ˆæ‰«ç è®°å½•è¯¦æƒ…å¤ç”¨åŸæœ‰ï¼‰ */
    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(15,23,42,0.55);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 50;
    }
    .modal-backdrop.active {
      display: flex;
    }
    .modal {
      width: 720px;
      max-width: 96%;
      max-height: 80vh;
      background: #ffffff;
      border-radius: 10px;
      box-shadow: 0 18px 40px rgba(15,23,42,0.35);
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }
    .modal-header {
      padding: 10px 14px;
      border-bottom: 1px solid #e5e7eb;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 13px;
    }
    .modal-title {
      font-weight: 600;
    }
    .modal-close {
      cursor: pointer;
      font-size: 18px;
      color: #6b7280;
    }
    .modal-body {
      padding: 10px 14px 12px;
      overflow-y: auto;
      font-size: 12px;
    }
    .detail-grid {
      display: grid;
      grid-template-columns: repeat(2,minmax(0,1fr));
      gap: 8px 16px;
      margin-bottom: 8px;
    }
    .detail-label {
      color: #6b7280;
      margin-bottom: 2px;
    }
    .detail-value {
      font-weight: 500;
    }
    pre.detail-json {
      background: #0b1120;
      color: #e5e7eb;
      border-radius: 6px;
      padding: 8px 10px;
      font-size: 11px;
      overflow-x: auto;
      white-space: pre-wrap;
      word-break: break-all;
    }

    /* è§†å›¾åˆ‡æ¢ç®€å•åŠ¨ç”» */
    .view-section { display: none; }
    .view-section.active { display: block; }
  </style>
</head>
<body>
<div class="layout">
  <!-- ä¾§è¾¹æ  -->
  <aside class="sidebar">
    <div class="sidebar-header">
      <span class="logo">A</span>
      <span>å®¶å®½è¿ç»´æ”¯æ’‘ç³»ç»Ÿ</span>
    </div>

    <div>
      <div class="menu-group-title">ç»ˆç«¯è¿è¥</div>
      <div class="menu-item">
        <span class="icon">ğŸ“¦</span>
        <span>è°ƒæ‹¨å‡ºå…¥åº“</span>
      </div>

      <div class="menu-group-title">é£æ§ & è®°å½•</div>
      <div class="menu-item active">
        <span class="icon">ğŸ“‹</span>
        <span>æ‰«ç è®°å½•ç®¡ç†</span>
      </div>
      <div class="submenu">
        <div class="submenu-item active" data-view="scan-log">
          <span>æ‰«ç è®°å½•æŸ¥è¯¢</span>
        </div>
        <div class="submenu-item" data-view="fault-log">
          <span>æ•…éšœç»ˆç«¯æŸ¥è¯¢</span>
        </div>
      </div>
    </div>
  </aside>

  <!-- ä¸»åŒºåŸŸ -->
  <div class="main">
    <header class="topbar">
      <div>
        <div class="breadcrumb">
          ç»ˆç«¯è¿è¥å¹³å° / æ‰«ç è®°å½•ç®¡ç† / <span class="current">æ‰«ç è®°å½•æŸ¥è¯¢</span>
        </div>
      </div>
      <div class="topbar-right">
        æ”¯æŒæŒ‰ä¸šåŠ¡ç±»å‹ã€æ‰«ç ç»“æœã€æ“ä½œäººã€å·¥å·ã€æ‰«ç æ¥æºç­‰ç»„åˆæŸ¥è¯¢
      </div>
    </header>

    <main class="content">
      <!-- æ‰«ç è®°å½•æŸ¥è¯¢è§†å›¾ -->
      <section id="view-scan-log" class="view-section active">
        <div class="page-title">
          <div>
            æ‰«ç è®°å½•æŸ¥è¯¢
            <div class="page-title-sub">æŸ¥è¯¢å¹¶å¯¼å‡º APP ç«¯è°ƒæ‹¨å‡ºå…¥åº“æ‰«ç è¡Œä¸ºä¸ä¸šåŠ¡å·¥å•çš„å…³è”è®°å½•</div>
          </div>
          <button id="btnExport" class="btn btn-secondary">â¬‡ å¯¼å‡ºå½“å‰ç»“æœ</button>
        </div>

        <!-- ç­›é€‰æ¡ä»¶ -->
        <section class="card">
          <div class="filter-grid">
            <div class="form-item">
              <label class="form-label">ä¸šåŠ¡ç±»å‹</label>
              <div class="form-control">
                <select id="filterBizType">
                  <option value="">å…¨éƒ¨</option>
                  <option value="è°ƒæ‹¨å‡ºåº“">è°ƒæ‹¨å‡ºåº“</option>
                  <option value="è°ƒæ‹¨å…¥åº“">è°ƒæ‹¨å…¥åº“</option>
                </select>
              </div>
            </div>

            <div class="form-item">
              <label class="form-label">æ‰«ç ç»“æœ</label>
              <div class="form-control">
                <select id="filterScanResult">
                  <option value="">å…¨éƒ¨</option>
                  <option value="æˆåŠŸ">æˆåŠŸ</option>
                  <option value="å°è´¦æ— è®°å½•">å°è´¦æ— è®°å½•</option>
                  <option value="é‡å¤æ‰«ç ">é‡å¤æ‰«ç </option>
                  <option value="æ ¡éªŒå¤±è´¥">æ ¡éªŒå¤±è´¥</option>
                </select>
              </div>
            </div>

            <div class="form-item">
              <label class="form-label">æ‰«ç æ¥æº</label>
              <div class="form-control">
                <select id="filterSource">
                  <option value="">å…¨éƒ¨</option>
                  <option value="è£…ç»´APP">è£…ç»´APP</option>
                  <option value="WEB">WEB</option>
                  <option value="æ¥å£æœåŠ¡">æ¥å£æœåŠ¡</option>
                </select>
              </div>
            </div>

            <div class="form-item">
              <label class="form-label">ä¸šåŠ¡å·¥å•å· / è®¢å•å·</label>
              <div class="form-control">
                <input id="filterBizOrderNo" type="text" placeholder="æ”¯æŒæ¨¡ç³ŠæŸ¥è¯¢">
              </div>
            </div>

            <div class="form-item">
              <label class="form-label">è®¾å¤‡è¯†åˆ«ç ï¼ˆä¸²ç ï¼‰</label>
              <div class="form-control">
                <input id="filterSn" type="text" placeholder="SN æˆ–æ¡ç å†…å®¹">
              </div>
            </div>

            <div class="form-item">
              <label class="form-label">æ“ä½œäººå§“å / å·¥å·</label>
              <div class="form-control">
                <input id="filterOperator" type="text" placeholder="å¦‚ï¼šå¼ ä¸‰ / 1008611">
              </div>
            </div>

            <div class="form-item">
              <label class="form-label">æ“ä½œæ—¶é—´èµ·</label>
              <div class="form-control">
                <input id="filterStartDate" type="date">
              </div>
            </div>

            <div class="form-item">
              <label class="form-label">æ“ä½œæ—¶é—´æ­¢</label>
              <div class="form-control">
                <input id="filterEndDate" type="date">
              </div>
            </div>
          </div>

          <div class="filter-actions">
            <button id="btnReset" class="btn btn-outline">é‡ç½®</button>
            <button id="btnSearch" class="btn btn-primary">æŸ¥è¯¢</button>
          </div>
        </section>

        <!-- ç»“æœåˆ—è¡¨ -->
        <section class="table-wrapper">
          <table>
            <thead>
            <tr>
              <th style="width:40px;">åºå·</th>
              <th>ä¸šåŠ¡ç±»å‹</th>
              <th>ä¸šåŠ¡å·¥å•å· / è®¢å•å·</th>
              <th>è®¾å¤‡è¯†åˆ«ç ï¼ˆä¸²ç ï¼‰</th>
              <th>æ‰«ç ç»“æœ</th>
              <th>å°è´¦åŒ¹é…ç»“æœ</th>
              <th>è¿”å›ç»“æœæè¿°</th>
              <th>æ“ä½œäºº</th>
              <th>æ‰«ç æ¥æº</th>
              <th>æ“ä½œæ—¶é—´</th>
              <th>è€—æ—¶(ms)</th>
              <th>è¯·æ±‚ID</th>
              <th>æ“ä½œ</th>
            </tr>
            </thead>
            <tbody id="tableBody">
            <!-- JS æ¸²æŸ“ -->
            </tbody>
          </table>

          <div class="table-footer">
            <span id="summaryText">å…± 0 æ¡è®°å½•</span>
            <div class="pager">
              <button id="btnPrev">&lt;</button>
              <button id="pageInfo" class="active">1 / 1</button>
              <button id="btnNext">&gt;</button>
            </div>
          </div>
        </section>
      </section>

      <!-- æ•…éšœç»ˆç«¯æŸ¥è¯¢è§†å›¾ -->
      <section id="view-fault-log" class="view-section">
        <div class="page-title">
          <div>
            æ•…éšœç»ˆç«¯æŸ¥è¯¢
            <div class="page-title-sub">æŸ¥è¯¢å¹¶å¯¼å‡ºæ•…éšœç»ˆç«¯å·¥å•åŠå…³è”è®¾å¤‡ä¿¡æ¯ï¼Œç”¨äºç«¯åˆ°ç«¯é—­ç¯è¿½è¸ª</div>
          </div>
          <button id="btnFaultExport" class="btn btn-secondary">â¬‡ å¯¼å‡ºå½“å‰ç»“æœ</button>
        </div>

        <!-- æ•…éšœå·¥å•ç­›é€‰ -->
        <section class="card">
          <div class="filter-grid">
            <div class="form-item">
              <label class="form-label">æ‰€å±åœ°å¸‚</label>
              <div class="form-control">
                <input id="filterFaultCity" type="text" placeholder="å¦‚ï¼šå†…è’™å¤Â·å‘¼å’Œæµ©ç‰¹å¸‚">
              </div>
            </div>
            <div class="form-item">
              <label class="form-label">æ‰€å±åŒºå¿</label>
              <div class="form-control">
                <input id="filterFaultCounty" type="text" placeholder="å¦‚ï¼šæ–°åŸåŒº">
              </div>
            </div>

            <div class="form-item">
              <label class="form-label">æ•…éšœæ¥æº</label>
              <div class="form-control">
                <select id="filterFaultSource">
                  <option value="">å…¨éƒ¨</option>
                  <option value="è£…ç»´APPåé¦ˆ">è£…ç»´APPåé¦ˆ</option>
                  <option value="å®¢æˆ·æŠ•è¯‰">å®¢æˆ·æŠ•è¯‰</option>
                  <option value="è´¨æ£€æŠ½æµ‹">è´¨æ£€æŠ½æµ‹</option>
                </select>
              </div>
            </div>

            <div class="form-item">
              <label class="form-label">æ•…éšœç±»å‹</label>
              <div class="form-control">
                <select id="filterFaultType">
                  <option value="">å…¨éƒ¨</option>
                  <option value="è®¾å¤‡æ— æ³•ä¸Šç”µ">è®¾å¤‡æ— æ³•ä¸Šç”µ</option>
                  <option value="WiFiä¿¡å·å¼‚å¸¸">WiFiä¿¡å·å¼‚å¸¸</option>
                  <option value="ç«¯å£ä¸å¯ç”¨">ç«¯å£ä¸å¯ç”¨</option>
                  <option value="é¢‘ç¹æ‰çº¿">é¢‘ç¹æ‰çº¿</option>
                  <option value="å…¶ä»–">å…¶ä»–</option>
                </select>
              </div>
            </div>

            <div class="form-item">
              <label class="form-label">å·¥å•çŠ¶æ€</label>
              <div class="form-control">
                <select id="filterFaultStatus">
                  <option value="">å…¨éƒ¨</option>
                  <option value="è‰ç¨¿">è‰ç¨¿</option>
                  <option value="å·²æäº¤">å·²æäº¤</option>
                </select>
              </div>
            </div>

            <div class="form-item">
              <label class="form-label">æ•…éšœå·¥å•ç¼–å·</label>
              <div class="form-control">
                <input id="filterFaultNo" type="text" placeholder="æ”¯æŒæ¨¡ç³ŠæŸ¥è¯¢">
              </div>
            </div>

            <div class="form-item">
              <label class="form-label">è®¾å¤‡è¯†åˆ«ç  / SN</label>
              <div class="form-control">
                <input id="filterFaultSn" type="text" placeholder="ç»ˆç«¯ä¸²ç æˆ–SN">
              </div>
            </div>

            <div class="form-item">
              <label class="form-label">åé¦ˆäºº / å·¥å·</label>
              <div class="form-control">
                <input id="filterFaultReporter" type="text" placeholder="å¦‚ï¼šæå›› / 1008622">
              </div>
            </div>

            <div class="form-item">
              <label class="form-label">åˆ›å»ºæ—¶é—´èµ·</label>
              <div class="form-control">
                <input id="filterFaultStartDate" type="date">
              </div>
            </div>
            <div class="form-item">
              <label class="form-label">åˆ›å»ºæ—¶é—´æ­¢</label>
              <div class="form-control">
                <input id="filterFaultEndDate" type="date">
              </div>
            </div>
          </div>

          <div class="filter-actions">
            <button id="btnFaultReset" class="btn btn-outline">é‡ç½®</button>
            <button id="btnFaultSearch" class="btn btn-primary">æŸ¥è¯¢</button>
          </div>
        </section>

        <!-- æ•…éšœå·¥å•åˆ—è¡¨ -->
        <section class="table-wrapper">
          <table>
            <thead>
            <tr>
              <th style="width:40px;">åºå·</th>
              <th>æ•…éšœå·¥å•ç¼–å·</th>
              <th>å·¥å•çŠ¶æ€</th>
              <th>æ•…éšœæ¥æº</th>
              <th>æ‰€å±åœ°å¸‚</th>
              <th>æ‰€å±åŒºå¿</th>
              <th>æ•…éšœç±»å‹</th>
              <th>æ•…éšœç­‰çº§</th>
              <th>è®¾å¤‡SN</th>
              <th>ç»ˆç«¯ç±»å‹</th>
              <th>åé¦ˆäºº</th>
              <th>åˆ›å»ºæ—¶é—´</th>
              <th>æ•…éšœå›¾ç‰‡æ•°</th>
            </tr>
            </thead>
            <tbody id="faultTableBody">
            <!-- JS æ¸²æŸ“ -->
            </tbody>
          </table>

          <div class="table-footer">
            <span id="faultSummaryText">å…± 0 æ¡è®°å½•</span>
            <div class="pager">
              <button id="btnFaultPrev">&lt;</button>
              <button id="faultPageInfo" class="active">1 / 1</button>
              <button id="btnFaultNext">&gt;</button>
            </div>
          </div>
        </section>
      </section>
    </main>
  </div>
</div>

<!-- æ‰«ç è®°å½•è¯¦æƒ…å¼¹çª—ï¼ˆåŸæœ‰é€»è¾‘ï¼‰ -->
<div id="detailModal" class="modal-backdrop">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-title">æ‰«ç è¯¦æƒ…</div>
      <div id="btnDetailClose" class="modal-close">âœ•</div>
    </div>
    <div class="modal-body">
      <div class="detail-grid" id="detailGrid">
        <!-- JS å¡«å……å…³é”®å­—æ®µ -->
      </div>
      <div style="margin-bottom:4px;font-size:12px;color:#4b5563;">è¯·æ±‚ / å“åº”åŸæ–‡ï¼š</div>
      <pre id="detailRaw" class="detail-json"></pre>
    </div>
  </div>
</div>

<script>
  // ========== å·¦ä¾§å­èœå•åˆ‡æ¢è§†å›¾ ==========
  const submenuItems = document.querySelectorAll('.submenu-item');
  const viewScanLog = document.getElementById('view-scan-log');
  const viewFaultLog = document.getElementById('view-fault-log');
  const breadcrumbCurrent = document.querySelector('.breadcrumb .current');
  const topbarRight = document.querySelector('.topbar-right');

  submenuItems.forEach(item => {
    item.addEventListener('click', () => {
      const viewKey = item.getAttribute('data-view');
      submenuItems.forEach(i => i.classList.remove('active'));
      item.classList.add('active');

      if (viewKey === 'scan-log') {
        viewScanLog.classList.add('active');
        viewFaultLog.classList.remove('active');
        breadcrumbCurrent.textContent = 'æ‰«ç è®°å½•æŸ¥è¯¢';
        topbarRight.textContent = 'æ”¯æŒæŒ‰ä¸šåŠ¡ç±»å‹ã€æ‰«ç ç»“æœã€æ“ä½œäººã€å·¥å·ã€æ‰«ç æ¥æºç­‰ç»„åˆæŸ¥è¯¢';
      } else {
        viewScanLog.classList.remove('active');
        viewFaultLog.classList.add('active');
        breadcrumbCurrent.textContent = 'æ•…éšœç»ˆç«¯æŸ¥è¯¢';
        topbarRight.textContent = 'æ”¯æŒæŒ‰åœ°å¸‚ã€æ•…éšœç±»å‹ã€çŠ¶æ€ã€è®¾å¤‡ä¸²ç ç­‰ç»„åˆæŸ¥è¯¢';
      }
    });
  });

  // ========== æ¨¡æ‹Ÿâ€œè°ƒæ‹¨å‡ºåº“ / è°ƒæ‹¨å…¥åº“â€æ‰«ç è®°å½• ==========
  const allRows = [
    {
      id: 1,
      bizType: 'è°ƒæ‹¨å‡ºåº“',
      bizOrderNo: 'DBDD202412050930',
      sn: 'SKYWA8EFF0AD',
      scanResult: 'æˆåŠŸ',
      matchResult: 'å·²åŒ¹é…å°è´¦',
      description: 'æ ¡éªŒé€šè¿‡ï¼ŒåŠ å…¥è°ƒæ‹¨å‡ºåº“è®¢å•ã€‚',
      operator: 'å¼ ä¸‰ / 1008611',
      source: 'è£…ç»´APP',
      opTime: '2024-12-05 09:30:21',
      duration: 128,
      reqId: 'REQ-20241205-0001',
      raw: {
        request: { url: '/api/scan/dispatch-out', sn: 'SKYWA8EFF0AD', orderNo: 'DBDD202412050930' },
        response: { code: 0, msg: 'OK', match: true }
      }
    },
    {
      id: 2,
      bizType: 'è°ƒæ‹¨å‡ºåº“',
      bizOrderNo: 'DBDD202412050930',
      sn: 'SN2233445566',
      scanResult: 'å°è´¦æ— è®°å½•',
      matchResult: 'ç³»ç»Ÿæ— å°è´¦è®°å½•',
      description: 'æœªåœ¨ç»ˆç«¯å°è´¦ä¸­æ‰¾åˆ°åŒ¹é…ä¸²ç ã€‚',
      operator: 'å¼ ä¸‰ / 1008611',
      source: 'è£…ç»´APP',
      opTime: '2024-12-05 09:30:32',
      duration: 156,
      reqId: 'REQ-20241205-0002',
      raw: {
        request: { url: '/api/scan/dispatch-out', sn: 'SN2233445566', orderNo: 'DBDD202412050930' },
        response: { code: 1001, msg: 'SN not found in catalog' }
      }
    },
    {
      id: 3,
      bizType: 'è°ƒæ‹¨å…¥åº“',
      bizOrderNo: 'DBDD202412041530',
      sn: 'SKYWA8EFF0AD',
      scanResult: 'æˆåŠŸ',
      matchResult: 'å·²åŒ¹é…å°è´¦',
      description: 'æ ¡éªŒé€šè¿‡ï¼ŒåŠ å…¥è°ƒæ‹¨å…¥åº“è®¢å•',
      operator: 'æå›› / 1008612',
      source: 'è£…ç»´APP',
      opTime: '2024-12-04 13:14:09',
      duration: 102,
      reqId: 'REQ-20241204-0001',
      raw: {
        request: { url: '/api/scan/dispatch-in', sn: 'SKYWA8EFF0AD', orderNo: 'DBDD202412041530' },
        response: {  code: 0, msg: 'OK', match: true  }
      }
    },
    {
      id: 4,
      bizType: 'è°ƒæ‹¨å‡ºåº“',
      bizOrderNo: 'ZJDD202412031110',
      sn: 'SN0000000000',
      scanResult: 'æ ¡éªŒå¤±è´¥',
      matchResult: 'ä¸²ç ä¸ç»ˆç«¯ç±»å‹ä¸ç¬¦',
      description: 'è£…æœºå·¥å•è¦æ±‚â€œå…‰çŒ«â€ï¼Œå½“å‰ä¸²ç å°è´¦ç»ˆç«¯ç±»å‹ä¸ºâ€œæœºé¡¶ç›’â€ï¼Œæ ¡éªŒä¸é€šè¿‡ã€‚',
      operator: 'ç‹äº” / 1008613',
      source: 'è£…ç»´APP',
      opTime: '2024-12-03 11:10:05',
      duration: 210,
      reqId: 'REQ-20241203-0009',
      raw: {
        request: { url: '/api/scan/dispatch-out', sn: 'SN0000000000', orderNo: 'ZJDD202412031110' },
        response: { code: 1003, msg: 'Device type mismatch' }
      }
    }
  ];

  // ç®€å•åˆ†é¡µï¼šæ¯é¡µ 10 æ¡
  const pageSize = 10;
  let currentPage = 1;
  let currentFiltered = [...allRows];

  const tableBody = document.getElementById('tableBody');
  const summaryText = document.getElementById('summaryText');
  const pageInfo = document.getElementById('pageInfo');
  const btnPrev = document.getElementById('btnPrev');
  const btnNext = document.getElementById('btnNext');

  function renderTable() {
    const total = currentFiltered.length;
    const totalPages = Math.max(1, Math.ceil(total / pageSize));
    if (currentPage > totalPages) currentPage = totalPages;

    const start = (currentPage - 1) * pageSize;
    const pageRows = currentFiltered.slice(start, start + pageSize);

    tableBody.innerHTML = '';
    pageRows.forEach((row, index) => {
      const tr = document.createElement('tr');

      const tdIndex = document.createElement('td');
      tdIndex.textContent = start + index + 1;
      tr.appendChild(tdIndex);

      const tdBizType = document.createElement('td');
      tdBizType.textContent = row.bizType;
      tr.appendChild(tdBizType);

      const tdBizOrder = document.createElement('td');
      tdBizOrder.textContent = row.bizOrderNo;
      tr.appendChild(tdBizOrder);

      const tdSn = document.createElement('td');
      tdSn.textContent = row.sn;
      tr.appendChild(tdSn);

      const tdScanResult = document.createElement('td');
      const tagScan = document.createElement('span');
      tagScan.className = 'tag ' + (
        row.scanResult === 'æˆåŠŸ' ? 'tag-success' :
          (row.scanResult === 'æ ¡éªŒå¤±è´¥' ? 'tag-danger' : 'tag-warning')
      );
      tagScan.textContent = row.scanResult;
      tdScanResult.appendChild(tagScan);
      tr.appendChild(tdScanResult);

      const tdMatch = document.createElement('td');
      tdMatch.textContent = row.matchResult;
      tr.appendChild(tdMatch);

      const tdDesc = document.createElement('td');
      tdDesc.textContent = row.description;
      tr.appendChild(tdDesc);

      const tdOp = document.createElement('td');
      tdOp.textContent = row.operator;
      tr.appendChild(tdOp);

      const tdSource = document.createElement('td');
      tdSource.textContent = row.source;
      tr.appendChild(tdSource);

      const tdTime = document.createElement('td');
      tdTime.textContent = row.opTime;
      tr.appendChild(tdTime);

      const tdDur = document.createElement('td');
      tdDur.textContent = row.duration;
      tr.appendChild(tdDur);

      const tdReq = document.createElement('td');
      tdReq.textContent = row.reqId;
      tr.appendChild(tdReq);

      const tdAction = document.createElement('td');
      const a = document.createElement('span');
      a.className = 'text-link';
      a.textContent = 'æŸ¥çœ‹è¯¦æƒ…';
      a.addEventListener('click', () => openDetail(row));
      tdAction.appendChild(a);
      tr.appendChild(tdAction);

      tableBody.appendChild(tr);
    });

    summaryText.textContent = `å…± ${total} æ¡è®°å½•`;
    pageInfo.textContent = `${total === 0 ? 0 : currentPage} / ${Math.max(1, totalPages)}`;
  }

  // ç­›é€‰ï¼ˆæ‰«ç è®°å½•ï¼‰
  function applyFilter() {
    const bizType = document.getElementById('filterBizType').value.trim();
    const scanResult = document.getElementById('filterScanResult').value.trim();
    const source = document.getElementById('filterSource').value.trim();
    const bizOrderNo = document.getElementById('filterBizOrderNo').value.trim();
    const sn = document.getElementById('filterSn').value.trim();
    const operator = document.getElementById('filterOperator').value.trim();
    const startDate = document.getElementById('filterStartDate').value;
    const endDate = document.getElementById('filterEndDate').value;

    currentFiltered = allRows.filter(row => {
      if (bizType && row.bizType !== bizType) return false;
      if (scanResult && row.scanResult !== scanResult) return false;
      if (source && row.source !== source) return false;
      if (bizOrderNo && !row.bizOrderNo.includes(bizOrderNo)) return false;
      if (sn && !row.sn.includes(sn)) return false;
      if (operator && row.operator.indexOf(operator) === -1) return false;

      if (startDate || endDate) {
        const ts = new Date(row.opTime.replace(/-/g,'/')).getTime();
        if (startDate) {
          const s = new Date(startDate + ' 00:00:00').getTime();
          if (ts < s) return false;
        }
        if (endDate) {
          const e = new Date(endDate + ' 23:59:59').getTime();
          if (ts > e) return false;
        }
      }
      return true;
    });

    currentPage = 1;
    renderTable();
  }

  document.getElementById('btnSearch').addEventListener('click', applyFilter);

  document.getElementById('btnReset').addEventListener('click', () => {
    ['filterBizType','filterScanResult','filterSource',
      'filterBizOrderNo','filterSn','filterOperator',
      'filterStartDate','filterEndDate'
    ].forEach(id => {
      document.getElementById(id).value = '';
    });
    currentFiltered = [...allRows];
    currentPage = 1;
    renderTable();
  });

  btnPrev.addEventListener('click', () => {
    if (currentPage > 1) {
      currentPage--;
      renderTable();
    }
  });
  btnNext.addEventListener('click', () => {
    const totalPages = Math.max(1, Math.ceil(currentFiltered.length / pageSize));
    if (currentPage < totalPages) {
      currentPage++;
      renderTable();
    }
  });

  // è¯¦æƒ…å¼¹æ¡†ï¼ˆæ‰«ç è®°å½•ï¼‰
  const detailModal = document.getElementById('detailModal');
  const btnDetailClose = document.getElementById('btnDetailClose');
  const detailGrid = document.getElementById('detailGrid');
  const detailRaw = document.getElementById('detailRaw');

  function openDetail(row) {
    detailGrid.innerHTML = '';
    const fields = [
      ['ä¸šåŠ¡ç±»å‹', row.bizType],
      ['ä¸šåŠ¡å·¥å•å· / è®¢å•å·', row.bizOrderNo],
      ['è®¾å¤‡è¯†åˆ«ç ï¼ˆä¸²ç ï¼‰', row.sn],
      ['æ‰«ç ç»“æœ', row.scanResult],
      ['å°è´¦åŒ¹é…ç»“æœ', row.matchResult],
      ['è¿”å›ç»“æœæè¿°', row.description],
      ['æ“ä½œäºº', row.operator],
      ['æ‰«ç æ¥æº', row.source],
      ['æ“ä½œæ—¶é—´', row.opTime],
      ['è€—æ—¶(ms)', row.duration.toString() ],
      ['è¯·æ±‚ID', row.reqId]
    ];
    fields.forEach(([label, value]) => {
      const wrapper = document.createElement('div');
      const l = document.createElement('div');
      l.className = 'detail-label';
      l.textContent = label;
      const v = document.createElement('div');
      v.className = 'detail-value';
      v.textContent = value;
      wrapper.appendChild(l);
      wrapper.appendChild(v);
      detailGrid.appendChild(wrapper);
    });

    detailRaw.textContent = JSON.stringify(row.raw, null, 2);
    detailModal.classList.add('active');
  }

  btnDetailClose.addEventListener('click', () => {
    detailModal.classList.remove('active');
  });
  detailModal.addEventListener('click', (e) => {
    if (e.target === detailModal) {
      detailModal.classList.remove('active');
    }
  });

  // å¯¼å‡º CSVï¼ˆæ‰«ç è®°å½•ï¼‰
  document.getElementById('btnExport').addEventListener('click', () => {
    if (!currentFiltered.length) {
      alert('å½“å‰æ— å¯å¯¼å‡ºçš„è®°å½•ã€‚');
      return;
    }
    const header = [
      'ä¸šåŠ¡ç±»å‹','ä¸šåŠ¡å·¥å•å·/è®¢å•å·','è®¾å¤‡è¯†åˆ«ç ï¼ˆä¸²ç ï¼‰','æ‰«ç ç»“æœ',
      'å°è´¦åŒ¹é…ç»“æœ','è¿”å›ç»“æœæè¿°','æ“ä½œäºº','æ‰«ç æ¥æº',
      'æ“ä½œæ—¶é—´','è€—æ—¶(ms)','è¯·æ±‚ID'
    ];
    const lines = [header.join(',')];
    currentFiltered.forEach(r => {
      lines.push([
        r.bizType,
        r.bizOrderNo,
        r.sn,
        r.scanResult,
        r.matchResult,
        `"${r.description.replace(/"/g,'""')}"`,
        r.operator,
        r.source,
        r.opTime,
        r.duration,
        r.reqId
      ].join(','));
    });
    const blob = new Blob([lines.join('\n')], {type: 'text/csv;charset=utf-8;'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'scan-log-export.csv';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
  });

  // åˆå§‹åŒ–æ‰«ç è®°å½•
  currentFiltered = [...allRows];
  renderTable();

  // ========== æ•…éšœç»ˆç«¯å·¥å•æ•°æ®ï¼ˆæ¥è‡ª APP æ•…éšœç»ˆç«¯é—­ç¯ç®¡ç†è„šæœ¬ç»“æ„ï¼‰ ==========
  const faultRows = [
    {
      id: 1,
      faultNo: 'GZGD202412050930',
      status: 'å·²æäº¤',
      source: 'è£…ç»´APPåé¦ˆ',
      city: 'å†…è’™å¤Â·å‘¼å’Œæµ©ç‰¹å¸‚',
      county: 'æ–°åŸåŒº',
      faultType: 'è®¾å¤‡æ— æ³•ä¸Šç”µ',
      faultLevel: 'é‡è¦',
      deviceSn: 'SKYWA8EFF0AD',
      deviceType: 'å…‰çŒ«-å®¶åº­ç½‘å…³',
      reporter: 'æå›› / 1008622',
      createTime: '2024-12-05 09:45:10',
      photoCount: 2
    },
    {
      id: 2,
      faultNo: 'GZGD202412041530',
      status: 'è‰ç¨¿',
      source: 'å®¢æˆ·æŠ•è¯‰',
      city: 'å†…è’™å¤Â·åŒ…å¤´å¸‚',
      county: 'æ˜†éƒ½ä»‘åŒº',
      faultType: 'WiFiä¿¡å·å¼‚å¸¸',
      faultLevel: 'ä¸€èˆ¬',
      deviceSn: 'SN1234567890',
      deviceType: 'å…‰çŒ«',
      reporter: 'ç‹å…­ / 1008633',
      createTime: '2024-12-04 15:32:21',
      photoCount: 1
    },
    {
      id: 3,
      faultNo: 'GZGD202412031110',
      status: 'å·²æäº¤',
      source: 'è´¨æ£€æŠ½æµ‹',
      city: 'å†…è’™å¤Â·å‘¼å’Œæµ©ç‰¹å¸‚',
      county: 'èµ›ç½•åŒº',
      faultType: 'é¢‘ç¹æ‰çº¿',
      faultLevel: 'ç´§æ€¥',
      deviceSn: 'SN0000000000',
      deviceType: 'å…‰çŒ«-å®¶åº­ç½‘å…³',
      reporter: 'å¼ ä¸‰ / 1008611',
      createTime: '2024-12-03 11:20:05',
      photoCount: 3
    }
  ];

  const faultPageSize = 10;
  let faultCurrentPage = 1;
  let faultCurrentFiltered = [...faultRows];

  const faultTableBody = document.getElementById('faultTableBody');
  const faultSummaryText = document.getElementById('faultSummaryText');
  const faultPageInfo = document.getElementById('faultPageInfo');
  const btnFaultPrev = document.getElementById('btnFaultPrev');
  const btnFaultNext = document.getElementById('btnFaultNext');

  function renderFaultTable() {
    const total = faultCurrentFiltered.length;
    const totalPages = Math.max(1, Math.ceil(total / faultPageSize));
    if (faultCurrentPage > totalPages) faultCurrentPage = totalPages;

    const start = (faultCurrentPage - 1) * faultPageSize;
    const pageRows = faultCurrentFiltered.slice(start, start + faultPageSize);

    faultTableBody.innerHTML = '';
    pageRows.forEach((row, index) => {
      const tr = document.createElement('tr');

      const tdIndex = document.createElement('td');
      tdIndex.textContent = start + index + 1;
      tr.appendChild(tdIndex);

      const tdNo = document.createElement('td');
      tdNo.textContent = row.faultNo;
      tr.appendChild(tdNo);

      const tdStatus = document.createElement('td');
      const tagStatus = document.createElement('span');
      tagStatus.className = 'tag ' + (row.status === 'å·²æäº¤' ? 'tag-success' : 'tag-warning');
      tagStatus.textContent = row.status;
      tdStatus.appendChild(tagStatus);
      tr.appendChild(tdStatus);

      const tdSource = document.createElement('td');
      tdSource.textContent = row.source;
      tr.appendChild(tdSource);

      const tdCity = document.createElement('td');
      tdCity.textContent = row.city;
      tr.appendChild(tdCity);

      const tdCounty = document.createElement('td');
      tdCounty.textContent = row.county;
      tr.appendChild(tdCounty);

      const tdType = document.createElement('td');
      tdType.textContent = row.faultType;
      tr.appendChild(tdType);

      const tdLevel = document.createElement('td');
      tdLevel.textContent = row.faultLevel;
      tr.appendChild(tdLevel);

      const tdSn = document.createElement('td');
      tdSn.textContent = row.deviceSn;
      tr.appendChild(tdSn);

      const tdDevType = document.createElement('td');
      tdDevType.textContent = row.deviceType;
      tr.appendChild(tdDevType);

      const tdReporter = document.createElement('td');
      tdReporter.textContent = row.reporter;
      tr.appendChild(tdReporter);

      const tdCreate = document.createElement('td');
      tdCreate.textContent = row.createTime;
      tr.appendChild(tdCreate);

      const tdPhoto = document.createElement('td');
      tdPhoto.textContent = row.photoCount;
      tr.appendChild(tdPhoto);

      faultTableBody.appendChild(tr);
    });

    faultSummaryText.textContent = `å…± ${total} æ¡è®°å½•`;
    faultPageInfo.textContent = `${total === 0 ? 0 : faultCurrentPage} / ${Math.max(1, totalPages)}`;
  }

  // æ•…éšœå·¥å•ç­›é€‰
  function applyFaultFilter() {
    const city = document.getElementById('filterFaultCity').value.trim();
    const county = document.getElementById('filterFaultCounty').value.trim();
    const source = document.getElementById('filterFaultSource').value.trim();
    const type = document.getElementById('filterFaultType').value.trim();
    const status = document.getElementById('filterFaultStatus').value.trim();
    const faultNo = document.getElementById('filterFaultNo').value.trim();
    const sn = document.getElementById('filterFaultSn').value.trim();
    const reporter = document.getElementById('filterFaultReporter').value.trim();
    const startDate = document.getElementById('filterFaultStartDate').value;
    const endDate = document.getElementById('filterFaultEndDate').value;

    faultCurrentFiltered = faultRows.filter(row => {
      if (city && row.city.indexOf(city) === -1) return false;
      if (county && row.county.indexOf(county) === -1) return false;
      if (source && row.source !== source) return false;
      if (type && row.faultType !== type) return false;
      if (status && row.status !== status) return false;
      if (faultNo && row.faultNo.indexOf(faultNo) === -1) return false;
      if (sn && row.deviceSn.indexOf(sn) === -1) return false;
      if (reporter && row.reporter.indexOf(reporter) === -1) return false;

      if (startDate || endDate) {
        const ts = new Date(row.createTime.replace(/-/g,'/')).getTime();
        if (startDate) {
          const s = new Date(startDate + ' 00:00:00').getTime();
          if (ts < s) return false;
        }
        if (endDate) {
          const e = new Date(endDate + ' 23:59:59').getTime();
          if (ts > e) return false;
        }
      }

      return true;
    });

    faultCurrentPage = 1;
    renderFaultTable();
  }

  document.getElementById('btnFaultSearch').addEventListener('click', applyFaultFilter);

  document.getElementById('btnFaultReset').addEventListener('click', () => {
    [
      'filterFaultCity',
      'filterFaultCounty',
      'filterFaultSource',
      'filterFaultType',
      'filterFaultStatus',
      'filterFaultNo',
      'filterFaultSn',
      'filterFaultReporter',
      'filterFaultStartDate',
      'filterFaultEndDate'
    ].forEach(id => {
      document.getElementById(id).value = '';
    });
    faultCurrentFiltered = [...faultRows];
    faultCurrentPage = 1;
    renderFaultTable();
  });

  btnFaultPrev.addEventListener('click', () => {
    if (faultCurrentPage > 1) {
      faultCurrentPage--;
      renderFaultTable();
    }
  });

  btnFaultNext.addEventListener('click', () => {
    const totalPages = Math.max(1, Math.ceil(faultCurrentFiltered.length / faultPageSize));
    if (faultCurrentPage < totalPages) {
      faultCurrentPage++;
      renderFaultTable();
    }
  });

  // æ•…éšœå·¥å•å¯¼å‡º
  document.getElementById('btnFaultExport').addEventListener('click', () => {
    if (!faultCurrentFiltered.length) {
      alert('å½“å‰æ— å¯å¯¼å‡ºçš„æ•…éšœç»ˆç«¯è®°å½•ã€‚');
      return;
    }
    const header = [
      'æ•…éšœå·¥å•ç¼–å·','å·¥å•çŠ¶æ€','æ•…éšœæ¥æº','æ‰€å±åœ°å¸‚','æ‰€å±åŒºå¿',
      'æ•…éšœç±»å‹','æ•…éšœç­‰çº§','è®¾å¤‡SN','ç»ˆç«¯ç±»å‹','åé¦ˆäºº','åˆ›å»ºæ—¶é—´','æ•…éšœå›¾ç‰‡æ•°'
    ];
    const lines = [header.join(',')];
    faultCurrentFiltered.forEach(r => {
      lines.push([
        r.faultNo,
        r.status,
        r.source,
        r.city,
        r.county,
        r.faultType,
        r.faultLevel,
        r.deviceSn,
        r.deviceType,
        `"${r.reporter.replace(/"/g,'""')}"`,
        r.createTime,
        r.photoCount
      ].join(','));
    });
    const blob = new Blob([lines.join('\n')], {type: 'text/csv;charset=utf-8;'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'fault-terminal-export.csv';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
  });

  // åˆå§‹åŒ–æ•…éšœç»ˆç«¯åˆ—è¡¨
  renderFaultTable();
</script>
</body>
</html>
